# üîß Remediation Writer Steering

## Purpose
This steering document guides Kiro in generating automated security fixes, PR descriptions, and remediation scripts for the Remediation Center.

## Core Principles

### 1. Safety First
- Never introduce breaking changes
- Preserve existing functionality
- Add tests when possible
- Include rollback instructions

### 2. Clear Communication
- Explain what the fix does
- Explain why it's needed
- Provide before/after examples
- Document any side effects

### 3. Best Practices
- Follow language conventions
- Use established patterns
- Leverage security libraries
- Implement defense in depth

## Remediation Script Format

Every remediation script should include:

```markdown
## üéØ Objective
[One sentence: what this fix accomplishes]

## üîç Changes Made
- [Change 1]
- [Change 2]
- [Change 3]

## ‚ö†Ô∏è Prerequisites
- [Requirement 1]
- [Requirement 2]

## üöÄ Implementation Steps
1. [Step 1]
2. [Step 2]
3. [Step 3]

## ‚úÖ Verification
- [ ] [Check 1]
- [ ] [Check 2]
- [ ] [Check 3]

## üîÑ Rollback Plan
If issues occur:
1. [Rollback step 1]
2. [Rollback step 2]
```

## PR Title Format

```
üîí [Security] Fix [Vulnerability Type] in [Component]
```

Examples:
- `üîí [Security] Fix SQL Injection in User Query Handler`
- `üîí [Security] Fix Hardcoded Credentials in AWS Config`
- `üîí [Security] Fix Missing CSRF Protection in API Routes`

## PR Description Template

```markdown
## üëª GhostOps Security Fix

### üêõ Vulnerability
**Severity**: [Critical/High/Medium/Low]
**Type**: [Vulnerability Category]
**Location**: `[file]:[line]`

[Brief description of the vulnerability]

### üîß Fix Applied
[Explanation of the fix]

**Changes:**
- ‚úÖ [Change 1]
- ‚úÖ [Change 2]
- ‚úÖ [Change 3]

### üìä Impact
**Before**: [Description of vulnerable state]
**After**: [Description of secure state]

### üß™ Testing
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] Manual testing completed
- [ ] Security scan shows improvement

### üìö References
- [Link to finding detail]
- [Link to security best practice]
- [Link to compliance requirement]

---
ü§ñ Generated by GhostOps | üëª Keeping your code ghost-free!
```

## Code Style Guidelines

### General Rules
- Match existing code style
- Use consistent indentation
- Add inline comments for complex logic
- Follow language-specific conventions

### Security-Specific Rules
- Use parameterized queries
- Validate all inputs
- Sanitize all outputs
- Use secure defaults
- Implement proper error handling
- Log security events

## Language-Specific Patterns

### JavaScript/TypeScript
```typescript
// ‚ùå Vulnerable
const query = `SELECT * FROM users WHERE id = ${userId}`;

// ‚úÖ Secure
const query = 'SELECT * FROM users WHERE id = ?';
const result = await db.query(query, [userId]);
```

### Python
```python
# ‚ùå Vulnerable
query = f"SELECT * FROM users WHERE id = {user_id}"

# ‚úÖ Secure
query = "SELECT * FROM users WHERE id = %s"
cursor.execute(query, (user_id,))
```

### Environment Variables
```javascript
// ‚ùå Vulnerable
const apiKey = 'sk_live_abc123';

// ‚úÖ Secure
const apiKey = process.env.API_KEY;
if (!apiKey) {
  throw new Error('API_KEY environment variable is required');
}
```

## Commit Message Format

```
fix(security): [brief description]

[Detailed explanation]

- What: [What was changed]
- Why: [Why it was changed]
- How: [How it fixes the issue]

Fixes: GhostOps-[finding-id]
Severity: [Critical/High/Medium/Low]
```

Example:
```
fix(security): prevent SQL injection in user query

Replaced string concatenation with parameterized queries
to prevent SQL injection attacks in the user lookup function.

- What: Updated database query method
- Why: Unsanitized input allowed SQL injection
- How: Using prepared statements with bound parameters

Fixes: GhostOps-1234
Severity: Critical
```

## Remediation Types

### Type 1: Code Replacement
**When**: Simple code fix
**Approach**: Direct replacement
**Example**: Hardcoded secrets ‚Üí Environment variables

### Type 2: Dependency Update
**When**: Vulnerable package version
**Approach**: Update package.json/requirements.txt
**Example**: React 17.0.1 ‚Üí React 18.2.0

### Type 3: Configuration Change
**When**: Missing security settings
**Approach**: Update config files
**Example**: Add security headers to next.config.js

### Type 4: Architecture Change
**When**: Fundamental design flaw
**Approach**: Refactor with explanation
**Example**: Add authentication middleware

## Testing Requirements

### Automated Tests
```javascript
// Always include tests with fixes
describe('Security Fix: SQL Injection Prevention', () => {
  it('should sanitize user input', () => {
    const maliciousInput = "1' OR '1'='1";
    const result = queryUser(maliciousInput);
    expect(result).not.toContainSQLInjection();
  });

  it('should use parameterized queries', () => {
    const userId = 123;
    const query = buildQuery(userId);
    expect(query).toUseParameterizedQuery();
  });
});
```

### Manual Testing Checklist
```markdown
- [ ] Original functionality preserved
- [ ] Security issue resolved
- [ ] No new vulnerabilities introduced
- [ ] Error handling works correctly
- [ ] Logs don't expose sensitive data
- [ ] Performance not degraded
```

## Spooky Integration

Use spooky tone from `spooky_tone.md` in:
- PR descriptions (intro only)
- Commit messages (footer)
- Remediation scripts (headers)

Example:
```markdown
## üëª Exorcising the SQL Injection Specter

This fix banishes the SQL injection vulnerability haunting your user query handler.
The phantom has been vanquished using parameterized queries!

[Technical details follow...]
```

## Error Handling

### If Fix Fails
```markdown
## ‚ö†Ô∏è Remediation Failed

**Reason**: [Error message]

**Possible Causes**:
1. [Cause 1]
2. [Cause 2]

**Manual Steps Required**:
1. [Step 1]
2. [Step 2]

**Need Help?**
- Review the finding detail
- Check the security documentation
- Contact the security team
```

### If Tests Fail
```markdown
## üß™ Tests Failed

The automated fix was applied but tests are failing.

**Failed Tests**:
- [Test 1]
- [Test 2]

**Recommended Actions**:
1. Review the changes
2. Update tests if needed
3. Verify fix doesn't break functionality
4. Re-run security scan
```

## Quality Checklist

Before submitting a remediation:

- [ ] Fix addresses the root cause
- [ ] No breaking changes introduced
- [ ] Code follows project conventions
- [ ] Tests included and passing
- [ ] Documentation updated
- [ ] PR description is clear
- [ ] Commit message follows format
- [ ] Spooky tone applied appropriately
- [ ] Security improvement verified
- [ ] Rollback plan documented

## Integration Points

This steering applies to:
- PR generation from Finding Detail
- Remediation scripts in Remediation Center
- Automated fix suggestions
- Commit messages
- PR descriptions
- Fix validation

---

**Goal**: Generate safe, effective, and well-documented security fixes that developers can trust and easily review.

üîß Secure Code = Happy Ghosts! üëª
